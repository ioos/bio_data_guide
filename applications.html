<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 2 Applications | Standardizing-Marine-Biological-Data</title>
  <meta name="description" content="Scaling multiple dimensions of diversity in biological data" />
  <meta name="generator" content="bookdown 0.24 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 2 Applications | Standardizing-Marine-Biological-Data" />
  <meta property="og:type" content="book" />
  <meta property="og:url" content="https://ioos.github.io/bio_data_guide/" />
  
  <meta property="og:description" content="Scaling multiple dimensions of diversity in biological data" />
  <meta name="github-repo" content="ioos/bio_data_guide" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 2 Applications | Standardizing-Marine-Biological-Data" />
  
  <meta name="twitter:description" content="Scaling multiple dimensions of diversity in biological data" />
  

<meta name="author" content="Standardizing Marine Biological Data Working Group" />


<meta name="date" content="2021-10-27" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="intro.html"/>
<link rel="next" href="final-words.html"/>
<script src="libs/header-attrs-2.11/header-attrs.js"></script>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Standardizing Marine Biological Data</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a></li>
<li class="chapter" data-level="1" data-path="intro.html"><a href="intro.html"><i class="fa fa-check"></i><b>1</b> Introduction</a>
<ul>
<li class="chapter" data-level="1.1" data-path="intro.html"><a href="intro.html#data-structures"><i class="fa fa-check"></i><b>1.1</b> Data Structures</a></li>
<li class="chapter" data-level="1.2" data-path="intro.html"><a href="intro.html#ontologies"><i class="fa fa-check"></i><b>1.2</b> Ontologies</a></li>
<li class="chapter" data-level="1.3" data-path="intro.html"><a href="intro.html#controlled-vocabularies"><i class="fa fa-check"></i><b>1.3</b> Controlled Vocabularies</a>
<ul>
<li class="chapter" data-level="1.3.1" data-path="intro.html"><a href="intro.html#taxonomy"><i class="fa fa-check"></i><b>1.3.1</b> Taxonomy</a></li>
<li class="chapter" data-level="1.3.2" data-path="intro.html"><a href="intro.html#resources"><i class="fa fa-check"></i><b>1.3.2</b> Resources</a></li>
<li class="chapter" data-level="1.3.3" data-path="intro.html"><a href="intro.html#oceanography"><i class="fa fa-check"></i><b>1.3.3</b> Oceanography</a></li>
<li class="chapter" data-level="1.3.4" data-path="intro.html"><a href="intro.html#biology"><i class="fa fa-check"></i><b>1.3.4</b> Biology</a></li>
<li class="chapter" data-level="1.3.5" data-path="intro.html"><a href="intro.html#nerc-search-interfaces"><i class="fa fa-check"></i><b>1.3.5</b> NERC Search Interfaces</a></li>
<li class="chapter" data-level="1.3.6" data-path="intro.html"><a href="intro.html#geosciences"><i class="fa fa-check"></i><b>1.3.6</b> Geosciences</a></li>
<li class="chapter" data-level="1.3.7" data-path="intro.html"><a href="intro.html#ecoenvo"><i class="fa fa-check"></i><b>1.3.7</b> Eco/EnvO</a></li>
<li class="chapter" data-level="1.3.8" data-path="intro.html"><a href="intro.html#wild-cards"><i class="fa fa-check"></i><b>1.3.8</b> Wild Cards</a></li>
</ul></li>
<li class="chapter" data-level="1.4" data-path="intro.html"><a href="intro.html#technologies"><i class="fa fa-check"></i><b>1.4</b> Technologies</a>
<ul>
<li class="chapter" data-level="1.4.1" data-path="intro.html"><a href="intro.html#erddap"><i class="fa fa-check"></i><b>1.4.1</b> ERDDAP</a></li>
</ul></li>
<li class="chapter" data-level="1.5" data-path="intro.html"><a href="intro.html#notes-on-integrating-obis-darwin-core-as-it-relates-to-ooss"><i class="fa fa-check"></i><b>1.5</b> Notes on Integrating OBIS, Darwin Core as it relates to OOS’s</a></li>
<li class="chapter" data-level="1.6" data-path="intro.html"><a href="intro.html#metadata"><i class="fa fa-check"></i><b>1.6</b> Metadata</a></li>
<li class="chapter" data-level="1.7" data-path="intro.html"><a href="intro.html#data-qc"><i class="fa fa-check"></i><b>1.7</b> Data QC</a>
<ul>
<li class="chapter" data-level="1.7.1" data-path="intro.html"><a href="intro.html#compliance-checking"><i class="fa fa-check"></i><b>1.7.1</b> Compliance Checking</a></li>
<li class="chapter" data-level="1.7.2" data-path="intro.html"><a href="intro.html#semantic-web-and-darwin-core"><i class="fa fa-check"></i><b>1.7.2</b> Semantic Web and Darwin Core</a></li>
<li class="chapter" data-level="1.7.3" data-path="intro.html"><a href="intro.html#resource-description-framework"><i class="fa fa-check"></i><b>1.7.3</b> Resource Description Framework</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="applications.html"><a href="applications.html"><i class="fa fa-check"></i><b>2</b> Applications</a>
<ul>
<li class="chapter" data-level="2.1" data-path="applications.html"><a href="applications.html#salmon-ocean-ecology-data"><i class="fa fa-check"></i><b>2.1</b> Salmon Ocean Ecology Data</a>
<ul>
<li class="chapter" data-level="2.1.1" data-path="applications.html"><a href="applications.html#intro-1"><i class="fa fa-check"></i><b>2.1.1</b> Intro</a></li>
<li class="chapter" data-level="2.1.2" data-path="applications.html"><a href="applications.html#event"><i class="fa fa-check"></i><b>2.1.2</b> event</a></li>
<li class="chapter" data-level="2.1.3" data-path="applications.html"><a href="applications.html#occurrence"><i class="fa fa-check"></i><b>2.1.3</b> occurrence</a></li>
<li class="chapter" data-level="2.1.4" data-path="applications.html"><a href="applications.html#measurementorfact"><i class="fa fa-check"></i><b>2.1.4</b> measurementOrFact</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="applications.html"><a href="applications.html#example-two"><i class="fa fa-check"></i><b>2.2</b> Example Two</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="final-words.html"><a href="final-words.html"><i class="fa fa-check"></i><b>3</b> Final Words</a></li>
<li class="chapter" data-level="4" data-path="tools.html"><a href="tools.html"><i class="fa fa-check"></i><b>4</b> Tools</a>
<ul>
<li class="chapter" data-level="4.1" data-path="tools.html"><a href="tools.html#r"><i class="fa fa-check"></i><b>4.1</b> R</a></li>
<li class="chapter" data-level="4.2" data-path="tools.html"><a href="tools.html#python"><i class="fa fa-check"></i><b>4.2</b> Python</a></li>
<li class="chapter" data-level="4.3" data-path="tools.html"><a href="tools.html#google-sheets"><i class="fa fa-check"></i><b>4.3</b> Google Sheets</a></li>
<li class="chapter" data-level="4.4" data-path="tools.html"><a href="tools.html#validators"><i class="fa fa-check"></i><b>4.4</b> Validators</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Standardizing-Marine-Biological-Data</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="applications" class="section level1" number="2">
<h1><span class="header-section-number">Chapter 2</span> Applications</h1>
<p>Some <em>significant</em> applications are demonstrated in this chapter.</p>
<div id="salmon-ocean-ecology-data" class="section level2" number="2.1">
<h2><span class="header-section-number">2.1</span> Salmon Ocean Ecology Data</h2>
<div id="intro-1" class="section level3" number="2.1.1">
<h3><span class="header-section-number">2.1.1</span> Intro</h3>
<p>One of the goals of the Hakai Institute and the Canadian Integrated Ocean Observing System (CIOOS) is to facilitate Open Science and FAIR (findable, accessible, interoperable, reusable) ecological and oceanographic data. In a concerted effort to adopt or establish how best to do that, several Hakai and CIOOS staff attended an International Ocean Observing System (IOOS) Code Sprint in Ann Arbour, Michigan between October 7–11, 2019, to discuss how to implement FAIR data principles for biological data collected in the marine environment.</p>
<p>The <a href="https://dwc.tdwg.org">Darwin Core</a> is a highly structured data format that standardizes data table relations, vocabularies, and defines field names. The Darwin Core defines three table types: <code>event</code>, <code>occurrence</code>, and <code>measurementOrFact</code>. This intuitively captures the way most ecologists conduct their research. Typically, a survey (event) is conducted and measurements, counts, or observations (collectively measurementOrFacts) are made regarding a specific habitat or species (occurrence).</p>
<p>In the following script I demonstrate how I go about converting a subset of the data collected from the Hakai Institute Juvenile Salmon Program and discuss challenges, solutions, pros and cons, and when and what’s worthwhile to convert to Darwin Core.</p>
<p>The conversion of a dataset to Darwin Core is much easier if your data are already tidy (normalized) in which you represent your data in separate tables that reflect the hierarchical and related nature of your observations. If your data are not already in a consistent and structured format, the conversion would likely be very arduous and not intuitive.</p>
</div>
<div id="event" class="section level3" number="2.1.2">
<h3><span class="header-section-number">2.1.2</span> event</h3>
<p>The first step is to consider what you will define as an event in your data set. I defined the capture of fish using a purse seine net as the <code>event</code>. Therefore, each row in the <code>event</code> table is one deployment of a seine net and is assigned a unique <code>eventID</code>.</p>
<p>My process for conversion was to make a new table called <code>event</code> and map the standard Darwin Core column names to pre-existing columns that serve the same purpose in my original <code>seine_data</code> table and populate the other required fields.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="applications.html#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co">#TODO: Include abiotic measurements (YSI temp and salinity from 0 and 1 m) to hang off eventID in the eMoF table</span></span>
<span id="cb1-2"><a href="applications.html#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="applications.html#cb1-3" aria-hidden="true" tabindex="-1"></a>event <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">datasetName =</span> <span class="st">&quot;Hakai Institute Juvenile Salmon Program&quot;</span>,</span>
<span id="cb1-4"><a href="applications.html#cb1-4" aria-hidden="true" tabindex="-1"></a>                <span class="at">eventID =</span> survey_seines<span class="sc">$</span>seine_id,</span>
<span id="cb1-5"><a href="applications.html#cb1-5" aria-hidden="true" tabindex="-1"></a>                <span class="at">eventDate =</span> <span class="fu">date</span>(survey_seines<span class="sc">$</span>survey_date),</span>
<span id="cb1-6"><a href="applications.html#cb1-6" aria-hidden="true" tabindex="-1"></a>                <span class="at">eventTime =</span> <span class="fu">paste0</span>(survey_seines<span class="sc">$</span>set_time, <span class="st">&quot;-0700&quot;</span>),</span>
<span id="cb1-7"><a href="applications.html#cb1-7" aria-hidden="true" tabindex="-1"></a>                <span class="at">eventRemarks =</span> <span class="fu">paste3</span>(survey_seines<span class="sc">$</span>survey_comments, survey_seines<span class="sc">$</span>seine_comments),</span>
<span id="cb1-8"><a href="applications.html#cb1-8" aria-hidden="true" tabindex="-1"></a>                <span class="at">decimalLatitude =</span> survey_seines<span class="sc">$</span>lat,</span>
<span id="cb1-9"><a href="applications.html#cb1-9" aria-hidden="true" tabindex="-1"></a>                <span class="at">decimalLongitude =</span> survey_seines<span class="sc">$</span>long,</span>
<span id="cb1-10"><a href="applications.html#cb1-10" aria-hidden="true" tabindex="-1"></a>                <span class="at">locationID =</span> survey_seines<span class="sc">$</span>site_id,</span>
<span id="cb1-11"><a href="applications.html#cb1-11" aria-hidden="true" tabindex="-1"></a>                <span class="at">coordinatePrecision =</span> <span class="fl">0.00001</span>,</span>
<span id="cb1-12"><a href="applications.html#cb1-12" aria-hidden="true" tabindex="-1"></a>                <span class="at">coordinateUncertaintyInMeters =</span> <span class="dv">10</span>,</span>
<span id="cb1-13"><a href="applications.html#cb1-13" aria-hidden="true" tabindex="-1"></a>                <span class="at">country =</span> <span class="st">&quot;Canada&quot;</span>,</span>
<span id="cb1-14"><a href="applications.html#cb1-14" aria-hidden="true" tabindex="-1"></a>                <span class="at">countryCode =</span> <span class="st">&quot;CA&quot;</span>,</span>
<span id="cb1-15"><a href="applications.html#cb1-15" aria-hidden="true" tabindex="-1"></a>                <span class="at">stateProvince =</span> <span class="st">&quot;British Columbia&quot;</span>,</span>
<span id="cb1-16"><a href="applications.html#cb1-16" aria-hidden="true" tabindex="-1"></a>                <span class="at">habitat =</span> <span class="st">&quot;Nearshore marine&quot;</span>,</span>
<span id="cb1-17"><a href="applications.html#cb1-17" aria-hidden="true" tabindex="-1"></a>                <span class="at">geodeticDatum =</span> <span class="st">&quot;EPSG:4326 WGS84&quot;</span>,</span>
<span id="cb1-18"><a href="applications.html#cb1-18" aria-hidden="true" tabindex="-1"></a>                <span class="at">minimumDepthInMeters =</span> <span class="dv">0</span>,</span>
<span id="cb1-19"><a href="applications.html#cb1-19" aria-hidden="true" tabindex="-1"></a>                <span class="at">maximumDepthInMeters =</span> <span class="dv">9</span>, <span class="co"># seine depth is 9 m</span></span>
<span id="cb1-20"><a href="applications.html#cb1-20" aria-hidden="true" tabindex="-1"></a>                <span class="at">samplingProtocol =</span> <span class="st">&quot;http://dx.doi.org/10.21966/1.566666&quot;</span>, <span class="co"># This is the DOI for the Hakai Salmon Data Package that contains the smnpling protocol, as well as the complete data package</span></span>
<span id="cb1-21"><a href="applications.html#cb1-21" aria-hidden="true" tabindex="-1"></a>                <span class="at">language =</span> <span class="st">&quot;en&quot;</span>,</span>
<span id="cb1-22"><a href="applications.html#cb1-22" aria-hidden="true" tabindex="-1"></a>                <span class="at">license =</span> <span class="st">&quot;http://creativecommons.org/licenses/by/4.0/legalcode&quot;</span>,</span>
<span id="cb1-23"><a href="applications.html#cb1-23" aria-hidden="true" tabindex="-1"></a>                <span class="at">bibliographicCitation =</span> <span class="st">&quot;Johnson, B.T., J.C.L. Gan, S.C. Godwin, M. Krkosek, B.P.V. Hunt. 2020. Hakai Juvenile Salmon Program Time Series. Hakai Institute, Quadra Island Ecological Observatory, Heriot Bay, British Columbia, Canada. v#.#.#, http://dx.doi.org/10.21966/1.566666&quot;</span>,</span>
<span id="cb1-24"><a href="applications.html#cb1-24" aria-hidden="true" tabindex="-1"></a>                <span class="at">references =</span> <span class="st">&quot;https://github.com/HakaiInstitute/jsp-data&quot;</span>,</span>
<span id="cb1-25"><a href="applications.html#cb1-25" aria-hidden="true" tabindex="-1"></a>                <span class="at">institutionID =</span> <span class="st">&quot;https://www.gbif.org/publisher/55897143-3f69-42f1-810d-ae94b55fde24, https://oceanexpert.org/institution/20121, https://edmo.seadatanet.org/report/5148&quot;</span>,</span>
<span id="cb1-26"><a href="applications.html#cb1-26" aria-hidden="true" tabindex="-1"></a>                <span class="at">institutionCode =</span> <span class="st">&quot;Hakai&quot;</span></span>
<span id="cb1-27"><a href="applications.html#cb1-27" aria-hidden="true" tabindex="-1"></a>               ) </span></code></pre></div>
</div>
<div id="occurrence" class="section level3" number="2.1.3">
<h3><span class="header-section-number">2.1.3</span> occurrence</h3>
<p>Next you’ll want to determine what constitutes an occurrence for your data set. Because each event captures fish, I consider each fish to be an occurrence. Therefore, the unit of observation (each row) in the occurrence table is a fish. To link each occurrence to an event you need to include the <code>eventID</code> column for every occurrence so that you know what seine (event) each fish (occurrence) came from. You must also provide a globally unique identifier for each occurrence. I already have a locally unique identifier for each fish in the original <code>fish_data</code> table called <code>ufn</code>. To make it globally unique I pre-pend the organization and research program metadata to the <code>ufn</code> column.</p>
<p>Not every fish is actually collected and given a Universal Fish Number (UFN) in our fish data tables, so in our field data sheets we record the total number of fish captured and the total number retained. So to get an occurrence row for every fish captured I create a row for every fish caught (minus the number taken) and create a generic numeric id (ie hakai-jsp-1) in one table and then join that to the fish table that includes a row for every fish retained that already has a UFN.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="applications.html#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="do">## make table long first</span></span>
<span id="cb2-2"><a href="applications.html#cb2-2" aria-hidden="true" tabindex="-1"></a>seines_total_long <span class="ot">&lt;-</span> survey_seines <span class="sc">%&gt;%</span> </span>
<span id="cb2-3"><a href="applications.html#cb2-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(seine_id, so_total, pi_total, cu_total, co_total, he_total, ck_total) <span class="sc">%&gt;%</span> </span>
<span id="cb2-4"><a href="applications.html#cb2-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="sc">-</span>seine_id, <span class="at">names_to =</span> <span class="st">&quot;scientificName&quot;</span>, <span class="at">values_to =</span> <span class="st">&quot;n&quot;</span>)</span>
<span id="cb2-5"><a href="applications.html#cb2-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-6"><a href="applications.html#cb2-6" aria-hidden="true" tabindex="-1"></a>seines_total_long<span class="sc">$</span>scientificName <span class="ot">&lt;-</span> <span class="fu">recode</span>(seines_total_long<span class="sc">$</span>scientificName, <span class="at">so_total =</span> <span class="st">&quot;Oncorhynchus nerka&quot;</span>, <span class="at">pi_total =</span> <span class="st">&quot;Oncorhynchus gorbuscha&quot;</span>, <span class="at">cu_total =</span> <span class="st">&quot;Oncorhynchus keta&quot;</span>, <span class="at">co_total =</span> <span class="st">&quot;Oncorhynchus kisutch&quot;</span>, <span class="at">ck_total =</span> <span class="st">&quot;Oncorhynchus tshawytscha&quot;</span>, <span class="at">he_total =</span> <span class="st">&quot;Clupea pallasii&quot;</span>) </span>
<span id="cb2-7"><a href="applications.html#cb2-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-8"><a href="applications.html#cb2-8" aria-hidden="true" tabindex="-1"></a>seines_taken_long <span class="ot">&lt;-</span> survey_seines <span class="sc">%&gt;%</span></span>
<span id="cb2-9"><a href="applications.html#cb2-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(seine_id, so_taken, pi_taken, cu_taken, co_taken, he_taken, ck_taken) <span class="sc">%&gt;%</span> </span>
<span id="cb2-10"><a href="applications.html#cb2-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="sc">-</span>seine_id, <span class="at">names_to =</span> <span class="st">&quot;scientificName&quot;</span>, <span class="at">values_to =</span> <span class="st">&quot;n_taken&quot;</span>) </span>
<span id="cb2-11"><a href="applications.html#cb2-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-12"><a href="applications.html#cb2-12" aria-hidden="true" tabindex="-1"></a>seines_taken_long<span class="sc">$</span>scientificName <span class="ot">&lt;-</span> <span class="fu">recode</span>(seines_taken_long<span class="sc">$</span>scientificName, <span class="at">so_taken =</span> <span class="st">&quot;Oncorhynchus nerka&quot;</span>, <span class="at">pi_taken =</span> <span class="st">&quot;Oncorhynchus gorbuscha&quot;</span>, <span class="at">cu_taken =</span> <span class="st">&quot;Oncorhynchus keta&quot;</span>, <span class="at">co_taken =</span> <span class="st">&quot;Oncorhynchus kisutch&quot;</span>, <span class="at">ck_taken =</span> <span class="st">&quot;Oncorhynchus tshawytscha&quot;</span>, <span class="at">he_taken =</span> <span class="st">&quot;Clupea pallasii&quot;</span>) </span>
<span id="cb2-13"><a href="applications.html#cb2-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-14"><a href="applications.html#cb2-14" aria-hidden="true" tabindex="-1"></a><span class="do">## remove records that have already been assigned an ID because they were actually retained</span></span>
<span id="cb2-15"><a href="applications.html#cb2-15" aria-hidden="true" tabindex="-1"></a>seines_long <span class="ot">&lt;-</span>  <span class="fu">full_join</span>(seines_total_long, seines_taken_long, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;seine_id&quot;</span>, <span class="st">&quot;scientificName&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb2-16"><a href="applications.html#cb2-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">drop_na</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb2-17"><a href="applications.html#cb2-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">n_not_taken =</span> n <span class="sc">-</span> n_taken) <span class="sc">%&gt;%</span> <span class="co">#so_total includes the number taken so I subtract n_taken to get n_not_taken</span></span>
<span id="cb2-18"><a href="applications.html#cb2-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>n_taken, <span class="sc">-</span>n) <span class="sc">%&gt;%</span> </span>
<span id="cb2-19"><a href="applications.html#cb2-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(n_not_taken <span class="sc">&gt;</span> <span class="dv">0</span>)</span>
<span id="cb2-20"><a href="applications.html#cb2-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-21"><a href="applications.html#cb2-21" aria-hidden="true" tabindex="-1"></a>all_fish_not_retained <span class="ot">&lt;-</span></span>
<span id="cb2-22"><a href="applications.html#cb2-22" aria-hidden="true" tabindex="-1"></a>  seines_long[<span class="fu">rep</span>(<span class="fu">seq.int</span>(<span class="dv">1</span>, <span class="fu">nrow</span>(seines_long)), seines_long<span class="sc">$</span>n_not_taken), <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>] <span class="sc">%&gt;%</span> </span>
<span id="cb2-23"><a href="applications.html#cb2-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>n_not_taken) <span class="sc">%&gt;%</span> </span>
<span id="cb2-24"><a href="applications.html#cb2-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">prefix =</span> <span class="st">&quot;hakai-jsp-&quot;</span>,</span>
<span id="cb2-25"><a href="applications.html#cb2-25" aria-hidden="true" tabindex="-1"></a>         <span class="at">suffix =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(.),</span>
<span id="cb2-26"><a href="applications.html#cb2-26" aria-hidden="true" tabindex="-1"></a>         <span class="at">occurrenceID =</span> <span class="fu">paste0</span>(prefix, suffix)</span>
<span id="cb2-27"><a href="applications.html#cb2-27" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb2-28"><a href="applications.html#cb2-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>prefix, <span class="sc">-</span>suffix)</span>
<span id="cb2-29"><a href="applications.html#cb2-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-30"><a href="applications.html#cb2-30" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb2-31"><a href="applications.html#cb2-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-32"><a href="applications.html#cb2-32" aria-hidden="true" tabindex="-1"></a><span class="co"># Change species names to full Scientific names </span></span>
<span id="cb2-33"><a href="applications.html#cb2-33" aria-hidden="true" tabindex="-1"></a>latin <span class="ot">&lt;-</span> <span class="fu">fct_recode</span>(fish_data<span class="sc">$</span>species, <span class="st">&quot;Oncorhynchus nerka&quot;</span> <span class="ot">=</span> <span class="st">&quot;SO&quot;</span>, <span class="st">&quot;Oncorhynchus gorbuscha&quot;</span> <span class="ot">=</span> <span class="st">&quot;PI&quot;</span>, <span class="st">&quot;Oncorhynchus keta&quot;</span> <span class="ot">=</span> <span class="st">&quot;CU&quot;</span>, <span class="st">&quot;Oncorhynchus kisutch&quot;</span> <span class="ot">=</span> <span class="st">&quot;CO&quot;</span>, <span class="st">&quot;Clupea pallasii&quot;</span> <span class="ot">=</span> <span class="st">&quot;HE&quot;</span>, <span class="st">&quot;Oncorhynchus tshawytscha&quot;</span> <span class="ot">=</span> <span class="st">&quot;CK&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb2-34"><a href="applications.html#cb2-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.character</span>()</span>
<span id="cb2-35"><a href="applications.html#cb2-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-36"><a href="applications.html#cb2-36" aria-hidden="true" tabindex="-1"></a>fish_retained_data <span class="ot">&lt;-</span> fish_data <span class="sc">%&gt;%</span> </span>
<span id="cb2-37"><a href="applications.html#cb2-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">scientificName =</span> latin) <span class="sc">%&gt;%</span> </span>
<span id="cb2-38"><a href="applications.html#cb2-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>species) <span class="sc">%&gt;%</span> </span>
<span id="cb2-39"><a href="applications.html#cb2-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">prefix =</span> <span class="st">&quot;hakai-jsp-&quot;</span>,</span>
<span id="cb2-40"><a href="applications.html#cb2-40" aria-hidden="true" tabindex="-1"></a>         <span class="at">occurrenceID =</span> <span class="fu">paste0</span>(prefix, ufn)) <span class="sc">%&gt;%</span> </span>
<span id="cb2-41"><a href="applications.html#cb2-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(seine_id, scientificName, occurrenceID)</span>
<span id="cb2-42"><a href="applications.html#cb2-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-43"><a href="applications.html#cb2-43" aria-hidden="true" tabindex="-1"></a>occurrence <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(all_fish_not_retained, fish_retained_data) <span class="sc">%&gt;%</span> </span>
<span id="cb2-44"><a href="applications.html#cb2-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">eventID =</span> seine_id) <span class="sc">%&gt;%</span>  <span class="co"># rename = dplyr::rename; vs plyr::rename</span></span>
<span id="cb2-45"><a href="applications.html#cb2-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="st">`</span><span class="at">Life stage</span><span class="st">`</span> <span class="ot">=</span> <span class="st">&quot;juvenile&quot;</span>)</span>
<span id="cb2-46"><a href="applications.html#cb2-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-47"><a href="applications.html#cb2-47" aria-hidden="true" tabindex="-1"></a>unique_taxa <span class="ot">&lt;-</span> <span class="fu">unique</span>(occurrence<span class="sc">$</span>scientificName)  </span>
<span id="cb2-48"><a href="applications.html#cb2-48" aria-hidden="true" tabindex="-1"></a>worms_names <span class="ot">&lt;-</span> <span class="fu">wm_records_names</span>(unique_taxa) <span class="co"># library(worrms)</span></span>
<span id="cb2-49"><a href="applications.html#cb2-49" aria-hidden="true" tabindex="-1"></a>df_worms_names <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(worms_names) <span class="sc">%&gt;%</span> </span>
<span id="cb2-50"><a href="applications.html#cb2-50" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="at">scientificName =</span> scientificname,</span>
<span id="cb2-51"><a href="applications.html#cb2-51" aria-hidden="true" tabindex="-1"></a>         <span class="at">scientificNameAuthorship =</span> authority,</span>
<span id="cb2-52"><a href="applications.html#cb2-52" aria-hidden="true" tabindex="-1"></a>         <span class="at">taxonRank =</span> rank,</span>
<span id="cb2-53"><a href="applications.html#cb2-53" aria-hidden="true" tabindex="-1"></a>         <span class="at">scientificNameID =</span> lsid</span>
<span id="cb2-54"><a href="applications.html#cb2-54" aria-hidden="true" tabindex="-1"></a>         )</span>
<span id="cb2-55"><a href="applications.html#cb2-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-56"><a href="applications.html#cb2-56" aria-hidden="true" tabindex="-1"></a><span class="co">#include bycatch species</span></span>
<span id="cb2-57"><a href="applications.html#cb2-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-58"><a href="applications.html#cb2-58" aria-hidden="true" tabindex="-1"></a>unique_bycatch <span class="ot">&lt;-</span> <span class="fu">unique</span>(bycatch<span class="sc">$</span>scientificName) <span class="sc">%&gt;%</span>  <span class="fu">glimpse</span>()</span></code></pre></div>
<pre><code>##  chr [1:29] &quot;Oncorhynchus nerka&quot; &quot;Oncorhynchus tshawytscha&quot; ...</code></pre>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="applications.html#cb4-1" aria-hidden="true" tabindex="-1"></a>by_worms_names <span class="ot">&lt;-</span> <span class="fu">wm_records_names</span>(unique_bycatch) <span class="sc">%&gt;%</span> </span>
<span id="cb4-2"><a href="applications.html#cb4-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb4-3"><a href="applications.html#cb4-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="at">scientificName =</span> scientificname,</span>
<span id="cb4-4"><a href="applications.html#cb4-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">scientificNameAuthorship =</span> authority,</span>
<span id="cb4-5"><a href="applications.html#cb4-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">taxonRank =</span> rank,</span>
<span id="cb4-6"><a href="applications.html#cb4-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">scientificNameID =</span> lsid</span>
<span id="cb4-7"><a href="applications.html#cb4-7" aria-hidden="true" tabindex="-1"></a>         )</span>
<span id="cb4-8"><a href="applications.html#cb4-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-9"><a href="applications.html#cb4-9" aria-hidden="true" tabindex="-1"></a>bycatch_occurrence <span class="ot">&lt;-</span> bycatch <span class="sc">%&gt;%</span> </span>
<span id="cb4-10"><a href="applications.html#cb4-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="at">eventID =</span> seine_id, occurrenceID, scientificName, <span class="st">`</span><span class="at">Life stage</span><span class="st">`</span> <span class="ot">=</span> bm_ageclass) <span class="sc">%&gt;%</span> </span>
<span id="cb4-11"><a href="applications.html#cb4-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(scientificName <span class="sc">!=</span> <span class="st">&quot;unknown&quot;</span>)</span>
<span id="cb4-12"><a href="applications.html#cb4-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-13"><a href="applications.html#cb4-13" aria-hidden="true" tabindex="-1"></a>bycatch_occurrence<span class="sc">$</span><span class="st">`</span><span class="at">Life stage</span><span class="st">`</span>[bycatch_occurrence<span class="sc">$</span><span class="st">`</span><span class="at">Life stage</span><span class="st">`</span> <span class="sc">==</span> <span class="st">&quot;J&quot;</span>] <span class="ot">&lt;-</span> <span class="st">&quot;juvenile&quot;</span></span>
<span id="cb4-14"><a href="applications.html#cb4-14" aria-hidden="true" tabindex="-1"></a>bycatch_occurrence<span class="sc">$</span><span class="st">`</span><span class="at">Life stage</span><span class="st">`</span>[bycatch_occurrence<span class="sc">$</span><span class="st">`</span><span class="at">Life stage</span><span class="st">`</span> <span class="sc">==</span> <span class="st">&quot;A&quot;</span>] <span class="ot">&lt;-</span> <span class="st">&quot;adult&quot;</span></span>
<span id="cb4-15"><a href="applications.html#cb4-15" aria-hidden="true" tabindex="-1"></a>bycatch_occurrence<span class="sc">$</span><span class="st">`</span><span class="at">Life stage</span><span class="st">`</span>[bycatch_occurrence<span class="sc">$</span><span class="st">`</span><span class="at">Life stage</span><span class="st">`</span> <span class="sc">==</span> <span class="st">&quot;Y&quot;</span>] <span class="ot">&lt;-</span> <span class="st">&quot;Young of year&quot;</span></span>
<span id="cb4-16"><a href="applications.html#cb4-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-17"><a href="applications.html#cb4-17" aria-hidden="true" tabindex="-1"></a>combined_worms_names <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(by_worms_names, df_worms_names) <span class="sc">%&gt;%</span> </span>
<span id="cb4-18"><a href="applications.html#cb4-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(scientificName, <span class="at">.keep_all =</span> <span class="cn">TRUE</span>)</span>
<span id="cb4-19"><a href="applications.html#cb4-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-20"><a href="applications.html#cb4-20" aria-hidden="true" tabindex="-1"></a>occurrence <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(bycatch_occurrence, occurrence)</span>
<span id="cb4-21"><a href="applications.html#cb4-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-22"><a href="applications.html#cb4-22" aria-hidden="true" tabindex="-1"></a>occurrence <span class="ot">&lt;-</span> <span class="fu">left_join</span>(occurrence, combined_worms_names) <span class="sc">%&gt;%</span> </span>
<span id="cb4-23"><a href="applications.html#cb4-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">basisOfRecord =</span> <span class="st">&quot;HumanObservation&quot;</span>,</span>
<span id="cb4-24"><a href="applications.html#cb4-24" aria-hidden="true" tabindex="-1"></a>        <span class="at">occurrenceStatus =</span> <span class="st">&quot;present&quot;</span>)</span>
<span id="cb4-25"><a href="applications.html#cb4-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-26"><a href="applications.html#cb4-26" aria-hidden="true" tabindex="-1"></a><span class="fu">write_csv</span>(occurrence,<span class="st">&quot;../datasets/hakai_salmon_data/raw_data/occurrence.csv&quot;</span>) <span class="co"># here::here(&quot;..&quot;, &quot;datasets&quot;, &quot;hakai_salmon_data&quot;, &quot;raw_data&quot;,   &quot;occurrence.csv&quot;))</span></span>
<span id="cb4-27"><a href="applications.html#cb4-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-28"><a href="applications.html#cb4-28" aria-hidden="true" tabindex="-1"></a><span class="co"># This removes events that didn&#39;t result in any occurrences</span></span>
<span id="cb4-29"><a href="applications.html#cb4-29" aria-hidden="true" tabindex="-1"></a>event <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">semi_join</span>(event, occurrence, <span class="at">by =</span> <span class="st">&#39;eventID&#39;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb4-30"><a href="applications.html#cb4-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">coordinateUncertaintyInMeters =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(decimalLatitude), <span class="dv">1852</span>, coordinateUncertaintyInMeters))</span>
<span id="cb4-31"><a href="applications.html#cb4-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-32"><a href="applications.html#cb4-32" aria-hidden="true" tabindex="-1"></a>simple_sites <span class="ot">&lt;-</span> sites <span class="sc">%&gt;%</span> </span>
<span id="cb4-33"><a href="applications.html#cb4-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(site_id, ocgy_std_lat, ocgy_std_lon)</span>
<span id="cb4-34"><a href="applications.html#cb4-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-35"><a href="applications.html#cb4-35" aria-hidden="true" tabindex="-1"></a>event <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">left_join</span>(event, simple_sites, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;locationID&quot;</span> <span class="ot">=</span> <span class="st">&quot;site_id&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb4-36"><a href="applications.html#cb4-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">decimalLatitude =</span> <span class="fu">coalesce</span>(decimalLatitude, ocgy_std_lat),</span>
<span id="cb4-37"><a href="applications.html#cb4-37" aria-hidden="true" tabindex="-1"></a>         <span class="at">decimalLongitude =</span> <span class="fu">coalesce</span>(decimalLongitude, ocgy_std_lon)) <span class="sc">%&gt;%</span> </span>
<span id="cb4-38"><a href="applications.html#cb4-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(ocgy_std_lat, ocgy_std_lon))</span>
<span id="cb4-39"><a href="applications.html#cb4-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-40"><a href="applications.html#cb4-40" aria-hidden="true" tabindex="-1"></a><span class="fu">write_csv</span>(event,<span class="st">&quot;../datasets/hakai_salmon_data/raw_data/event.csv&quot;</span>) <span class="co"># here::here(&quot;..&quot;, &quot;datasets&quot;, &quot;hakai_salmon_data&quot;, &quot;raw_data&quot;,   &quot;event.csv&quot;))</span></span></code></pre></div>
</div>
<div id="measurementorfact" class="section level3" number="2.1.4">
<h3><span class="header-section-number">2.1.4</span> measurementOrFact</h3>
<p>To convert all your measurements or facts from your normal format to Darwin Core you essentially need to put all your measurements into one column called measurementType and a corresponding column called MeasurementValue. This standardizes the column names are in the <code>measurementOrFact</code> table. There are a number of predefined <code>measurementType</code>s listed on the <a href="https://www.bodc.ac.uk/resources/vocabularies/">NERC</a> database that should be used where possible. I found it difficult to navigate this page to find the correct <code>measurementType</code>.</p>
<p>Here I convert length, and weight measurements that relate to an event and an occurrence and call those <code>measurementTypes</code> as <code>length</code> and <code>weight</code>.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="applications.html#cb5-1" aria-hidden="true" tabindex="-1"></a>mof_types <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">&quot;https://raw.githubusercontent.com/HakaiInstitute/jsp-data/master/OBIS_data/mof_type_units_id.csv&quot;</span>)</span>
<span id="cb5-2"><a href="applications.html#cb5-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-3"><a href="applications.html#cb5-3" aria-hidden="true" tabindex="-1"></a>fish_data<span class="sc">$</span>weight <span class="ot">&lt;-</span> <span class="fu">coalesce</span>(fish_data<span class="sc">$</span>weight, fish_data<span class="sc">$</span>weight_field)</span>
<span id="cb5-4"><a href="applications.html#cb5-4" aria-hidden="true" tabindex="-1"></a>fish_data<span class="sc">$</span>fork_length <span class="ot">&lt;-</span> <span class="fu">coalesce</span>(fish_data<span class="sc">$</span>fork_length, fish_data<span class="sc">$</span>fork_length_field)</span>
<span id="cb5-5"><a href="applications.html#cb5-5" aria-hidden="true" tabindex="-1"></a>fish_data<span class="sc">$</span><span class="st">`</span><span class="at">Life stage</span><span class="st">`</span> <span class="ot">&lt;-</span> <span class="st">&quot;juvenile&quot;</span></span>
<span id="cb5-6"><a href="applications.html#cb5-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-7"><a href="applications.html#cb5-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-8"><a href="applications.html#cb5-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-9"><a href="applications.html#cb5-9" aria-hidden="true" tabindex="-1"></a>measurementOrFact <span class="ot">&lt;-</span> fish_data <span class="sc">%&gt;%</span></span>
<span id="cb5-10"><a href="applications.html#cb5-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">occurrenceID =</span> <span class="fu">paste0</span>(<span class="st">&quot;hakai-jsp-&quot;</span>, ufn)) <span class="sc">%&gt;%</span> </span>
<span id="cb5-11"><a href="applications.html#cb5-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(occurrenceID, <span class="at">eventID =</span> seine_id, <span class="st">&quot;Length (fork length)&quot;</span> <span class="ot">=</span> fork_length,</span>
<span id="cb5-12"><a href="applications.html#cb5-12" aria-hidden="true" tabindex="-1"></a>         <span class="st">&quot;Standard length&quot;</span> <span class="ot">=</span> standard_length, <span class="st">&quot;Weight&quot;</span> <span class="ot">=</span> weight, <span class="st">`</span><span class="at">Life stage</span><span class="st">`</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb5-13"><a href="applications.html#cb5-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="st">`</span><span class="at">Length (fork length)</span><span class="st">`</span><span class="sc">:</span><span class="st">`</span><span class="at">Life stage</span><span class="st">`</span>,</span>
<span id="cb5-14"><a href="applications.html#cb5-14" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">&quot;measurementType&quot;</span>,</span>
<span id="cb5-15"><a href="applications.html#cb5-15" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">&quot;measurementValue&quot;</span>,</span>
<span id="cb5-16"><a href="applications.html#cb5-16" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_transform =</span> <span class="fu">list</span>(<span class="at">measurementValue =</span> as.character)) <span class="sc">%&gt;%</span></span>
<span id="cb5-17"><a href="applications.html#cb5-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(measurementValue <span class="sc">!=</span> <span class="st">&quot;NA&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb5-18"><a href="applications.html#cb5-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(mof_types,<span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;measurementType&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb5-19"><a href="applications.html#cb5-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">measurementValueID =</span> <span class="fu">case_when</span>(measurementValue <span class="sc">==</span> <span class="st">&quot;juvenile&quot;</span> <span class="sc">~</span> <span class="st">&quot;http://vocab.nerc.ac.uk/collection/S11/current/S1127/&quot;</span>),</span>
<span id="cb5-20"><a href="applications.html#cb5-20" aria-hidden="true" tabindex="-1"></a>         <span class="at">measurementID =</span> <span class="fu">paste</span>(eventID, measurementType, occurrenceID, <span class="at">sep =</span> <span class="st">&quot;-&quot;</span>))</span>
<span id="cb5-21"><a href="applications.html#cb5-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-22"><a href="applications.html#cb5-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-23"><a href="applications.html#cb5-23" aria-hidden="true" tabindex="-1"></a><span class="fu">write_csv</span>(measurementOrFact,<span class="st">&quot;../datasets/hakai_salmon_data/raw_data/extendedMeasurementOrFact.csv&quot;</span>) <span class="co"># here::here(&quot;..&quot;, &quot;datasets&quot;, &quot;hakai_salmon_data&quot;, &quot;raw_data&quot;,   &quot;extendedMeasurementOrFact.csv&quot;))</span></span></code></pre></div>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="applications.html#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Check that every eventID in Occurrence occurs in event table</span></span>
<span id="cb6-2"><a href="applications.html#cb6-2" aria-hidden="true" tabindex="-1"></a>no_keys <span class="ot">&lt;-</span> <span class="fu">dm</span>(event, occurrence, measurementOrFact)</span>
<span id="cb6-3"><a href="applications.html#cb6-3" aria-hidden="true" tabindex="-1"></a>only_pk <span class="ot">&lt;-</span> no_keys <span class="sc">%&gt;%</span> </span>
<span id="cb6-4"><a href="applications.html#cb6-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dm_add_pk</span>(event, eventID) <span class="sc">%&gt;%</span> </span>
<span id="cb6-5"><a href="applications.html#cb6-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dm_add_pk</span>(occurrence, occurrenceID) <span class="sc">%&gt;%</span> </span>
<span id="cb6-6"><a href="applications.html#cb6-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dm_add_pk</span>(measurementOrFact, measurementID)</span>
<span id="cb6-7"><a href="applications.html#cb6-7" aria-hidden="true" tabindex="-1"></a><span class="fu">dm_examine_constraints</span>(only_pk)</span>
<span id="cb6-8"><a href="applications.html#cb6-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-9"><a href="applications.html#cb6-9" aria-hidden="true" tabindex="-1"></a>model <span class="ot">&lt;-</span> only_pk <span class="sc">%&gt;%</span> </span>
<span id="cb6-10"><a href="applications.html#cb6-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dm_add_fk</span>(occurrence, eventID, event) <span class="sc">%&gt;%</span> </span>
<span id="cb6-11"><a href="applications.html#cb6-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dm_add_fk</span>(measurementOrFact, occurrenceID, occurrence)</span>
<span id="cb6-12"><a href="applications.html#cb6-12" aria-hidden="true" tabindex="-1"></a><span class="fu">dm_examine_constraints</span>(model)</span>
<span id="cb6-13"><a href="applications.html#cb6-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-14"><a href="applications.html#cb6-14" aria-hidden="true" tabindex="-1"></a><span class="co">#TODO: Fix bookdown issues so that dm_draw shows data model html output. Perhaps add  `always_allow_html: true` to yaml front matter</span></span>
<span id="cb6-15"><a href="applications.html#cb6-15" aria-hidden="true" tabindex="-1"></a><span class="co"># dm_draw(model, view_type = &quot;all&quot;) </span></span></code></pre></div>
</div>
</div>
<div id="example-two" class="section level2" number="2.2">
<h2><span class="header-section-number">2.2</span> Example Two</h2>
<p>Add another example here, perhaps zooplankton?</p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="intro.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="final-words.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": true,
"facebook": true,
"twitter": true,
"linkedin": true,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": {}
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/ioos/bio_data_guide/edit/main/bio-data-guide/02-application.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": "https://github.com/ioos/bio_data_guide/blob/main/bio-data-guide/02-application.Rmd",
"text": null
},
"download": ["bio-data-guide.pdf", "bio-data-guide.epub"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
},
"info": false
});
});
</script>

</body>

</html>
